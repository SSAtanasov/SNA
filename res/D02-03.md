# IPv4 адресиране и сегментиране на мрежата
## Записки за подготовка на студентите

---

### Предназначение на IPv4 адреса
**Основна роля:**
- IPv4 адресът е логически мрежов адрес за уникална идентификация на устройство
- Необходим за участие в интернет и локални мрежи
- Трябва да бъде правилно конфигуриран и уникален

**Важно:** Всеки пакет в интернет съдържа изходящ и целеви IPv4 адрес

---

### Октети и десетична нотация с точки
**Ключови понятия:**
- IPv4 адресът е 32-битов
- Разделя се на 4 октета (по 8 бита)
- Пример: `11010001.10100101.11001000.00000001` → `209.165.200.1`
- Десетичната нотация с точки улеснява четенето и конфигурирането

**За запомняне:** Преобразуването между двоична и десетична бройна система е основно умение

---

### Структура на IPv4 адреса
**Йерархична структура:**
- **Мрежова част** - идентифицира мрежата
- **Част за устройство (host)** - идентифицира конкретното устройство в мрежата

**Правило:** Всички устройства в една мрежа имат еднаква мрежова част, но различна host част

**Пример:**
- `192.168.5.11` с маска `255.255.255.0`
- Мрежова част: `192.168.5`
- Host част: `11`

**Важно:** Ако мрежовата част на адреса не съответства на локалната мрежа, устройството няма да може да комуникира

**Множество логически мрежи на една физическа:**
На една физическа мрежа (един switch) могат да съществуват множество логически IP мрежи, ако устройствата имат различна мрежова част. Например: 3 устройства с `192.168.18.x` и 3 устройства с `192.168.5.x` на един switch - те са на една физическа мрежа, но на две различни логически мрежи и **не могат** да комуникират помежду си без маршрутизатор.

---

### Аналогия с телефонната система
Телефонната система е също йерархична:
- Код на държавата + код на района + префикс = мрежов адрес
- Останалите цифри = локален телефонен номер

---

### Unicast предаване
**Определение:** Предаване от едно устройство към друго (един към един)

**Характеристики:**
- Изходящият адрес е винаги unicast
- Целевият адрес е конкретно устройство
- Диапазон: `1.1.1.1` до `223.255.255.255` (с изключения)

**Практически пример:** Устройство `172.16.4.1` изпраща до принтер `172.16.4.253`

---

### Дължина на префикса (Prefix Length)
**Нотация:** `/24` означава 24-битова мрежова маска
- `/24` = `255.255.255.0`
- В двоична система: 24 единици, следвани от 8 нули

---

### Broadcast предаване
**Определение:** Предаване към всички устройства в мрежата (един към всички)

**Характеристики:**
- Целеви адрес: `255.255.255.255` (ограничено излъчване)
- Или всички единици в host частта (насочено излъчване)
- Маршрутизаторите НЕ препращат broadcast пакети между мрежи
- IPv6 НЕ поддържа broadcast

**Важно:** 
- Прекалено много broadcast трафик влошава производителността
- Комутаторите разпространяват broadcast навсякъде
- Маршрутизаторите разделят broadcast домейни

**Примери за broadcast:** ARP заявки, DHCP discover съобщения

---

### Multicast предаване
**Определение:** Предаване към избрана група устройства

**Характеристики:**
- Диапазон: `224.0.0.0` до `239.255.255.255`
- Устройствата се абонират за multicast група
- Пример: OSPF използва `224.0.0.5`
- Само абонираните устройства обработват пакета

**Как работи:** Всяка multicast група се представя от един IPv4 multicast адрес. Устройствата обработват пакети към multicast групата и към собствения си unicast адрес.

---

### Публични и частни IPv4 адреси
**Публични адреси:**
- Глобално маршрутизируеми в интернет
- Уникални в световен мащаб
- Разпределяни от RIR (регионални интернет регистри)

**Частни адреси:**
- `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`
- Използват се в локални мрежи
- Не са маршрутизируеми в интернет
- Изискват NAT за достъп до интернет

**Исторически контекст:** Въведени през средата на 1990-те заради изчерпване на IPv4 адреси

---

### Маршрутизация към интернет с NAT
**Проблем:** Частните адреси не могат да се маршрутизират в интернет

**Решение - NAT (Network Address Translation):**
- Преобразува частни адреси в публични
- Извършва се на маршрутизатора към ISP
- Позволява на устройства с частни адреси да достигат интернет

**Как работи:** Изходящ частен адрес → NAT → публичен адрес → интернет

---

### Адреси със специална употреба

**Loopback адреси:** `127.0.0.0/8` (обикновено `127.0.0.1`)
- За тестване на локалното устройство
- Трафикът остава в устройството
- Използва се с команда `ping` за проверка на IP конфигурацията

**Link-Local адреси:** `169.254.0.0/16`
- Автоматично присвоявани (APIPA)
- Когато не е достъпен DHCP сървър
- Windows самоконфигурация

---

### Остаряло класово адресиране
**Исторически класове (RFC 790 от 1981):**
- **Клас A:** `0.0.0.0/8` до `127.0.0.0/8` (над 16 млн. устройства на мрежа)
- **Клас B:** `128.0.0.0/16` до `191.255.0.0/16` (над 65 000 устройства на мрежа)
- **Клас C:** `192.0.0.0/24` до `223.255.255.0/24` (254 устройства на мрежа)

**Проблем:** Неефективно разпределение - Клас A и B имаха твърде много адреси, Клас C твърде малко

**Решение:** От средата на 1990-те се използва безкласово адресиране (CIDR), което игнорира класовете

---

### Присвояване на IP адреси
**Организационна структура:**
- **IANA** - управлява и разпределя адреси на RIR
- **RIR** - регионални регистри (AfriNIC, APNIC, ARIN, LACNIC, RIPE NCC)
- **ISP** - доставчици на интернет услуги
- **Крайни потребители** - организации и домашни потребители

**Процес:** IANA → RIR → ISP → Организации/Потребители

---

### Broadcast домейни и сегментиране
**Ключови понятия:**
- **Broadcast домейн** - всички устройства, които получават broadcast
- **Комутаторите** препращат broadcast навсякъде
- **Маршрутизаторите** разделят broadcast домейни
- Всеки интерфейс на маршрутизатор е отделен broadcast домейн

**Примери за broadcast:**
- **ARP заявки** - устройство изпраща ARP заявка (Layer 2 broadcast) в локалната мрежа за известен IPv4 адрес, за да открие свързания MAC адрес
- **DHCP съобщения** - устройство изпраща DHCP discover за намиране на DHCP сървър

**Важно:** Комутаторът разпространява broadcast навсякъде, но маршрутизаторът НЕ го препраща между мрежи

---

### Проблеми с големи broadcast домейни
**Проблем:** 400 потребителя в една мрежа → прекалено много broadcast трафик

**Решение:** Разделяне на подмрежи (subnetting)
- Пример: `172.16.0.0/16` → `172.16.0.0/24` + `172.16.1.0/24`
- От една мрежа с 400 потребителя → две мрежи по 200 потребителя

**Терминология:** Термините "subnet" и "network" често се използват взаимозаменяемо. Повечето мрежи всъщност са подмрежа на по-голям адресен блок.

**Основа на subnetting:** Използване на битове от host частта за създаване на допълнителни подмрежи (префиксът се увеличава от /16 на /24)

---

### Причини за сегментиране
**Предимства на subnetting:**
1. Намаляване на broadcast трафика
2. Подобрена сигурност - контрол кои подмрежи могат да комуникират
3. По-добра организация
4. Ефективно използване на адреси
5. Намаляване на устройствата, засегнати от неправилен broadcast (грешни конфигурации, проблеми или злонамерени действия)

**Начини за сегментиране:**
- По местоположение (етажи, сгради)
- По отдели (HR, IT, Продажби)
- По функция (служители, гости, администрация)
- По тип устройства (сървъри, работни станции, принтери)

**Важно умение:** Разбирането как да се правят подмрежи е основно умение, което всички мрежови администратори трябва да развият. С практика процесът става по-лесен.

---

### Мрежова маска (Subnet Mask)
**Функция:** Показва границата между мрежова и host част

**Правило:**
- `1` в маската → мрежова част
- `0` в маската → host част

**Пример:**
```
IP адрес:    192.168.10.10    (11000000.10101000.00001010.00001010)
Subnet mask: 255.255.255.0    (11111111.11111111.11111111.00000000)
             └─ мрежова част (24 бита) ─┘└─ host (8 бита) ─┘
```

---

### AND операция за определяне на мрежата
**Метод:** Двоична AND операция между IP адрес и маска

**Защо е нужна:**
За да препрати данни, устройството трябва да знае в коя мрежа се намира. Използвайки собствения си IP адрес, мрежовата маска и процес наречен binary ANDing, устройството може да определи мрежовия адрес.

**Правило на AND:**
- 1 AND 1 = 1
- 1 AND 0 = 0
- 0 AND 1 = 0
- 0 AND 0 = 0

**Пример:**
```
IP адрес:      192.168.10.10   (11000000.10101000.00001010.00001010)
Subnet mask:   255.255.255.0   (11111111.11111111.11111111.00000000)
                                 ↓ AND операция бит по бит ↓
Мрежов адрес:  192.168.10.0    (11000000.10101000.00001010.00000000)
```

**Приложение:** Устройството сравнява собствения си мрежов адрес с мрежовия адрес на целта - ако съвпадат, целта е в същата локална мрежа; ако не съвпадат, пакетът се изпраща към default gateway (маршрутизатора).

---

### Защо правим Subnetting?
**1. Намаляване на broadcast трафик**
- Без subnetting: 400 потребителя → всички получават broadcast
- Със subnetting: 2 мрежи по 200 → broadcast само в подмрежата

**2. Подобрена сигурност**
- Разделяне на отдели
- Контрол на комуникацията между групи

**3. По-добра организация**
- По местоположение, отдел или тип устройство

**4. Ефективно използване**
- `/16` = 65 534 адреса
- `/24` = 254 адреса
- Избираме според нуждите

---

### Практически пример за subnetting
**Сценарий:** Фирма с 3 отдела

**Преди:**
- `192.168.0.0/16` - всички 300 компютъра в една мрежа ❌

**След:**
- HR: `192.168.1.0/24` (254 адреса)
- IT: `192.168.2.0/24` (254 адреса)
- Продажби: `192.168.3.0/24` (254 адреса)
- Всеки отдел е отделна мрежа ✅

---

### Ключови точки за запомняне
- Subnet mask определя границата между мрежа и host
- Prefix length (`/24`) е съкратен запис на маска
- AND операцията дава мрежовия адрес
- Subnetting подобрява производителност и сигурност
- Router разделя broadcast домейни

---

### IPv4 заглавна част (Header)
**Важни полета в IPv4 заглавката:**
- **Version** - 4-битова стойност = 0100 (идентифицира IPv4)
- **DiffServ (Differentiated Services)** - 8-битово поле за приоритет на пакета
- **TTL (Time to Live)** - 8-битова стойност; намалява се с 1 на всеки маршрутизатор; при 0 пакетът се изхвърля
- **Protocol** - 8-битово поле за протокола от по-горно ниво (TCP=6, UDP=17, ICMP=1)
- **Source IP** - 32-битов изходящ адрес (винаги unicast)
- **Destination IP** - 32-битов целеви адрес (unicast, multicast или broadcast)
- **Header Checksum** - контролна сума за откриване на грешки в заглавката

**Забележка:** При всяко намаляване на TTL, маршрутизаторът трябва да преизчисли Header Checksum

---

### Мрежови, host и broadcast адреси
**Структура на мрежа:**
- **Мрежов адрес** - първият адрес (всички нули в host частта)
- **Broadcast адрес** - последният адрес (всички единици в host частта)
- **Използваеми адреси** - между мрежовия и broadcast адреса

**Пример за `192.168.2.0/24`:**
- Мрежов адрес: `192.168.2.0`
- Първи използваем: `192.168.2.1`
- Последен използваем: `192.168.2.254`
- Broadcast адрес: `192.168.2.255`
- Общо използваеми адреси: 254

**Метод за определяне:**
1. AND операция → мрежов адрес
2. Всички единици в host част → broadcast адрес
3. Между тях → използваеми адреси

---

## Въпроси за самопроверка

1. Каква е дължината на IPv4 адрес?
2. Как се наричат 8-битовите групи в IPv4 адрес?
3. Каква е разликата между unicast, broadcast и multicast?
4. Какви са диапазоните на частните IPv4 адреси?
5. Защо маршрутизаторите не препращат broadcast пакети?
6. Какво е subnetting и защо се използва?
7. Какво показва мрежовата маска?
8. Как се определя мрежовият адрес чрез AND операция?
9. Кои адреси в дадена мрежа не могат да се използват за устройства?
10. Какво означава нотацията `/24`?

---

## Основни термини за запомняне

- **Октет** - 8-битова група
- **Unicast** - предаване към едно устройство
- **Broadcast** - предаване към всички устройства
- **Multicast** - предаване към група устройства
- **Subnet mask** - маска, определяща мрежовата част
- **Prefix length** - дължина на мрежовата част (напр. `/24`)
- **NAT** - преобразуване на мрежови адреси
- **Broadcast домейн** - област, в която се разпространява broadcast
- **Subnetting** - разделяне на мрежа на подмрежи
- **AND операция** - двоична операция за определяне на мрежата


<script data-goatcounter="https://satanasov.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

<script src="/SNA/assets/js/analytics-logger.js"></script>
