# –£—Ä–æ–∫ 5: TCP –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–µ–Ω –ø—Ä–æ—Ü–µ—Å –≤—ä–≤ Wireshark

## –¶–µ–ª–∏ –Ω–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ—Ç–æ

–°–ª–µ–¥ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ —Ç–æ–≤–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —â–µ –º–æ–∂–µ—Ç–µ –¥–∞:

- –†–∞–∑–±–µ—Ä–µ—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è—Ç–∞ –∑–∞ connection-oriented –ø—Ä–æ—Ç–æ–∫–æ–ª
- –ó–∞—Å–Ω–µ–º–µ—Ç–µ –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞—Ç–µ TCP Three-Way Handshake –ø—Ä–æ—Ü–µ—Å–∞
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞—Ç–µ TCP Control Bits (—Ñ–ª–∞–≥–æ–≤–µ)
- –ù–∞–±–ª—é–¥–∞–≤–∞—Ç–µ –∫–∞–∫ —Å–µ —Ç–µ—Ä–º–∏–Ω–∏—Ä–∞ TCP –≤—Ä—ä–∑–∫–∞
- –ê–Ω–∞–ª–∏–∑–∏—Ä–∞—Ç–µ Sequence Numbers –∏ Acknowledgment Numbers
- –°–ª–µ–¥–∏—Ç–µ –ø—ä–ª–µ–Ω TCP conversation

## –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –æ—Å–Ω–æ–≤–∞

**TCP (Transmission Control Protocol)** –µ –µ–¥–∏–Ω –æ—Ç –æ—Å–Ω–æ–≤–Ω–∏—Ç–µ transport layer –ø—Ä–æ—Ç–æ–∫–æ–ª–∏. TCP –µ **connection-oriented –ø—Ä–æ—Ç–æ–∫–æ–ª** - —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ —É—Å—Ç–∞–Ω–æ–≤–∏ –≤—Ä—ä–∑–∫–∞ –ø—Ä–µ–¥–∏ –æ–±–º–µ–Ω –Ω–∞ –¥–∞–Ω–Ω–∏.

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞ TCP:

‚úÖ **Connection-oriented** - –ò–∑–∏—Å–∫–≤–∞ —É—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –≤—Ä—ä–∑–∫–∞  
‚úÖ **Reliable** - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ —á—Ä–µ–∑ acknowledgments  
‚úÖ **Ordered** - –î–∞–Ω–Ω–∏—Ç–µ –ø—Ä–∏—Å—Ç–∏–≥–∞—Ç –≤ —Å—ä—â–∏—è —Ä–µ–¥  
‚úÖ **Error-checking** - –ò–∑–ø–æ–ª–∑–≤–∞ checksums  
‚úÖ **Flow control** - Window size –º–µ—Ö–∞–Ω–∏–∑—ä–º  

### TCP vs UDP:

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | TCP | UDP |
|----------------|-----|-----|
| Connection | Connection-oriented | Connectionless |
| –ù–∞–¥–µ–∂–¥–Ω–æ—Å—Ç | Reliable | Unreliable (best effort) |
| –†–µ–¥ –Ω–∞ –¥–∞–Ω–Ω–∏ | Ordered | Unordered |
| –°–∫–æ—Ä–æ—Å—Ç | –ü–æ-–±–∞–≤–µ–Ω | –ü–æ-–±—ä—Ä–∑ |
| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è | HTTP, FTP, SSH | DNS, VoIP, Gaming |

---

## TCP Three-Way Handshake

–ü—Ä–µ–¥–∏ –æ–±–º–µ–Ω –Ω–∞ –¥–∞–Ω–Ω–∏, TCP —É—Å—Ç–∞–Ω–æ–≤—è–≤–∞ –≤—Ä—ä–∑–∫–∞ —Å **Three-Way Handshake**:

```
Client                                  Server
  |                                       |
  |  1. SYN (Seq=0)                      |
  |-------------------------------------->|
  |                                       |
  |  2. SYN-ACK (Seq=0, Ack=1)           |
  |<--------------------------------------|
  |                                       |
  |  3. ACK (Seq=1, Ack=1)               |
  |-------------------------------------->|
  |                                       |
  |     Connection Established!           |
```

**–°—Ç—ä–ø–∫–∞ 1:** –ö–ª–∏–µ–Ω—Ç –∏–∑–ø—Ä–∞—â–∞ **SYN** (Synchronize)  
**–°—Ç—ä–ø–∫–∞ 2:** –°—ä—Ä–≤—ä—Ä –æ—Ç–≥–æ–≤–∞—Ä—è —Å **SYN-ACK** (Synchronize-Acknowledge)  
**–°—Ç—ä–ø–∫–∞ 3:** –ö–ª–∏–µ–Ω—Ç –∏–∑–ø—Ä–∞—â–∞ **ACK** (Acknowledge)  

---

## TCP Control Bits (Flags)

TCP –∏–º–∞ 6 –æ—Å–Ω–æ–≤–Ω–∏ control flags:

| Flag | –ò–º–µ | –§—É–Ω–∫—Ü–∏—è |
|------|-----|---------|
| **URG** | Urgent | Urgent data |
| **ACK** | Acknowledgment | –ü–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –ø–æ–ª—É—á–µ–Ω–∏ –¥–∞–Ω–Ω–∏ |
| **PSH** | Push | –ò–∑–ø—Ä–∞—Ç–∏ –¥–∞–Ω–Ω–∏ –≤–µ–¥–Ω–∞–≥–∞ |
| **RST** | Reset | Reset –Ω–∞ –≤—Ä—ä–∑–∫–∞—Ç–∞ |
| **SYN** | Synchronize | –£—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –≤—Ä—ä–∑–∫–∞ |
| **FIN** | Finish | –¢–µ—Ä–º–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Ä—ä–∑–∫–∞ |

---

## –ù–µ–æ–±—Ö–æ–¥–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∏

- 1 PC (Windows 10)
- Wireshark –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω
- –î–æ—Å—Ç—ä–ø –¥–æ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç
- Web browser

---

## –ß–∞—Å—Ç 1: –ó–∞—Å–Ω–µ–º–∞–Ω–µ –Ω–∞ TCP Three-Way Handshake

### –°—Ç—ä–ø–∫–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ Wireshark

**a.** –°—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ Wireshark

**b.** –ò–∑–±–µ—Ä–µ—Ç–µ –∞–∫—Ç–∏–≤–Ω–∏—è network interface

**c.** –í filter bar –Ω–∞–ø–∏—à–µ—Ç–µ:
```
tcp
```

**d.** –ö–ª–∏–∫–Ω–µ—Ç–µ **Start capturing packets**

### –°—Ç—ä–ø–∫–∞ 2: –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ TCP connection

**a.** –û—Ç–≤–æ—Ä–µ—Ç–µ web browser (Chrome, Firefox, Edge)

**b.** –ü–æ—Å–µ—Ç–µ—Ç–µ –ø—Ä–æ—Å—Ç HTTP —É–µ–±—Å–∞–π—Ç (–Ω–µ HTTPS):

- http://neverssl.com
- http://example.com
- http://info.cern.ch

> **–í–∞–∂–Ω–æ:** –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ HTTP (–Ω–µ HTTPS), –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω TCP —Ç—Ä–∞—Ñ–∏–∫!

**c.** –ò–∑—á–∞–∫–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ –¥–∞ —Å–µ –∑–∞—Ä–µ–¥–∏ –Ω–∞–ø—ä–ª–Ω–æ

**d.** –°–ø—Ä–µ—Ç–µ capture-–∞ –≤—ä–≤ Wireshark

### –°—Ç—ä–ø–∫–∞ 3: –§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ TCP connection

**a.** –ó–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ —Å–∞–º–æ –≤–∞—à–∏—è HTTP connection, –¥–æ–±–∞–≤–µ—Ç–µ —Ñ–∏–ª—Ç—ä—Ä:
```
tcp.port == 80
```

–©–µ –≤–∏–¥–∏—Ç–µ —Å–∞–º–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –∫—ä–º –ø–æ—Ä—Ç 80 (HTTP).

### –°—Ç—ä–ø–∫–∞ 4: –ù–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ Three-Way Handshake

**a.** –í packet list pane (–≥–æ—Ä–µ), –ø–æ—Ç—ä—Ä—Å–µ—Ç–µ –ø—ä—Ä–≤–∏—Ç–µ —Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞:

–ü–∞–∫–µ—Ç 1: Info –ø–æ–∫–∞–∑–≤–∞ **[SYN]**  
–ü–∞–∫–µ—Ç 2: Info –ø–æ–∫–∞–∑–≤–∞ **[SYN, ACK]**  
–ü–∞–∫–µ—Ç 3: Info –ø–æ–∫–∞–∑–≤–∞ **[ACK]**  

–¢–æ–≤–∞ –µ Three-Way Handshake!

### –°—Ç—ä–ø–∫–∞ 5: –ê–Ω–∞–ª–∏–∑ –Ω–∞ SYN –ø–∞–∫–µ—Ç (–°—Ç—ä–ø–∫–∞ 1 –Ω–∞ handshake)

**a.** –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –ø—ä—Ä–≤–∏—è –ø–∞–∫–µ—Ç —Å **[SYN]**

**b.** –í packet details pane, —Ä–∞–∑–≥—ä–Ω–µ—Ç–µ **Transmission Control Protocol**

```
Transmission Control Protocol, Src Port: 54321, Dst Port: 80
    Source Port: 54321
    Destination Port: 80 (HTTP)
    Sequence Number: 0    (relative sequence number)
    Acknowledgment Number: 0
    Header Length: 32 bytes (8)
    Flags: 0x002 (SYN)
        000. .... .... = Reserved: Not set
        ...0 .... .... = Nonce: Not set
        .... 0... .... = Congestion Window Reduced: Not set
        .... .0.. .... = ECN-Echo: Not set
        .... ..0. .... = Urgent: Not set
        .... ...0 .... = Acknowledgment: Not set
        .... .... 0... = Push: Not set
        .... .... .0.. = Reset: Not set
        .... .... ..1. = Syn: Set
        .... .... ...0 = Fin: Not set
    Window: 65535
    Checksum: 0x1234 [unverified]
```

**c.** –û—Ç–≥–æ–≤–æ—Ä–µ—Ç–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ:

_–ö–∞–∫—ä–≤ –µ Source Port?_ ________________ (–ø—Ä–æ–∏–∑–≤–æ–ª–µ–Ω –≤–∏—Å–æ–∫ –Ω–æ–º–µ—Ä)

_–ö–∞–∫—ä–≤ –µ Destination Port?_ **80 (HTTP)**

_–ö–∞–∫—ä–≤ –µ Sequence Number?_ **0** (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª–µ–Ω –Ω–æ–º–µ—Ä –≤—ä–≤ Wireshark)

_–ö–æ–π flag –µ –∑–∞–¥–∞–¥–µ–Ω?_ **SYN**

_ACK flag –∑–∞–¥–∞–¥–µ–Ω –ª–∏ –µ?_ **–ù–µ**

> **–í–∞–∂–Ω–æ:** Sequence number –≤—Å—ä—â–Ω–æ—Å—Ç –µ 32-–±–∏—Ç–æ–≤–æ —Å–ª—É—á–∞–π–Ω–æ —á–∏—Å–ª–æ (ISN - Initial Sequence Number). Wireshark –≥–æ –ø–æ–∫–∞–∑–≤–∞ –∫–∞—Ç–æ 0 –∑–∞ —É–ª–µ—Å–Ω–µ–Ω–∏–µ.

### –°—Ç—ä–ø–∫–∞ 6: –ê–Ω–∞–ª–∏–∑ –Ω–∞ SYN-ACK –ø–∞–∫–µ—Ç (–°—Ç—ä–ø–∫–∞ 2)

**a.** –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –≤—Ç–æ—Ä–∏—è –ø–∞–∫–µ—Ç —Å **[SYN, ACK]**

**b.** –†–∞–∑–≥—ä–Ω–µ—Ç–µ **Transmission Control Protocol**

```
Transmission Control Protocol, Src Port: 80, Dst Port: 54321
    Source Port: 80 (HTTP)
    Destination Port: 54321
    Sequence Number: 0    (relative sequence number)
    Acknowledgment Number: 1    (relative ack number)
    Flags: 0x012 (SYN, ACK)
        .... ...0 .... = Acknowledgment: Not set ‚Üí –ì–†–ï–®–ö–ê!
        .... .... ..1. = Syn: Set
        .... .... ...0 = Fin: Not set
```

–ü—Ä–∞–≤–∏–ª–Ω–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ:
```
    Flags: 0x012 (SYN, ACK)
        .... ...1 .... = Acknowledgment: Set
        .... .... ..1. = Syn: Set
```

**c.** –û—Ç–≥–æ–≤–æ—Ä–µ—Ç–µ:

_Source –∏ Destination –ø–æ—Ä—Ç–æ–≤–µ —Ä–∞–∑–º–µ–Ω–µ–Ω–∏ –ª–∏ —Å–∞?_ **–î–∞**

_–ö–∞–∫–≤–∏ flags —Å–∞ –∑–∞–¥–∞–¥–µ–Ω–∏?_ **SYN –∏ ACK**

_–ö–∞–∫—ä–≤ –µ Sequence Number?_ **0** (—Å—ä—Ä–≤—ä—Ä—ä—Ç —Å—ä—â–æ –∑–∞–ø–æ—á–≤–∞ –æ—Ç 0)

_–ö–∞–∫—ä–≤ –µ Acknowledgment Number?_ **1** (–ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—è SYN)

### –°—Ç—ä–ø–∫–∞ 7: –ê–Ω–∞–ª–∏–∑ –Ω–∞ ACK –ø–∞–∫–µ—Ç (–°—Ç—ä–ø–∫–∞ 3)

**a.** –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ —Ç—Ä–µ—Ç–∏—è –ø–∞–∫–µ—Ç —Å **[ACK]** (–±–µ–∑ SYN)

**b.** –†–∞–∑–≥—ä–Ω–µ—Ç–µ **Transmission Control Protocol**

```
Transmission Control Protocol, Src Port: 54321, Dst Port: 80
    Source Port: 54321
    Destination Port: 80
    Sequence Number: 1
    Acknowledgment Number: 1
    Flags: 0x010 (ACK)
        .... ...1 .... = Acknowledgment: Set
        .... .... ..0. = Syn: Not set
        .... .... ...0 = Fin: Not set
```

**c.** –û—Ç–≥–æ–≤–æ—Ä–µ—Ç–µ:

_–ö–æ–π flag –µ –∑–∞–¥–∞–¥–µ–Ω?_ **ACK**

_SYN flag –∑–∞–¥–∞–¥–µ–Ω –ª–∏ –µ?_ **–ù–µ**

_–ö–∞–∫—ä–≤ –µ Acknowledgment Number?_ **1** (–ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ —Å—ä—Ä–≤—ä—Ä—Å–∫–∏—è SYN)

**Connection –µ —É—Å—Ç–∞–Ω–æ–≤–µ–Ω–∞!** üéâ

---

## –ß–∞—Å—Ç 2: –ù–∞–±–ª—é–¥–∞–≤–∞–Ω–µ –Ω–∞ Data Transfer

### –°—Ç—ä–ø–∫–∞ 1: –ù–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ HTTP GET request

**a.** –°–ª–µ–¥ Three-Way Handshake, –ø–æ—Ç—ä—Ä—Å–µ—Ç–µ –ø–∞–∫–µ—Ç —Å Info: **HTTP GET** –∏–ª–∏ **[PSH, ACK]**

**b.** –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –ø–∞–∫–µ—Ç–∞

**c.** –†–∞–∑–≥—ä–Ω–µ—Ç–µ **Transmission Control Protocol**

```
Transmission Control Protocol
    Sequence Number: 1
    Acknowledgment Number: 1
    Flags: 0x018 (PSH, ACK)
        .... ...1 .... = Acknowledgment: Set
        .... .... 1... = Push: Set
```

**d.** –ó–∞–±–µ–ª–µ–∂–µ—Ç–µ:

_PSH flag –æ–∑–Ω–∞—á–∞–≤–∞ –∫–∞–∫–≤–æ?_ 

**Push** - –¥–∞–Ω–Ω–∏—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –∏–∑–ø—Ä–∞—Ç—è—Ç –≤–µ–¥–Ω–∞–≥–∞ –¥–æ application layer (–Ω–µ —á–∞–∫–∞—Ç –≤ buffer).

_ACK flag –≤–∏–Ω–∞–≥–∏ –∑–∞–¥–∞–¥–µ–Ω –ª–∏ –µ —Å–ª–µ–¥ handshake?_

**–î–∞** - —Å–ª–µ–¥ —É—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –≤—Ä—ä–∑–∫–∞, –≤—Å–µ–∫–∏ –ø–∞–∫–µ—Ç –ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –ø–æ–ª—É—á–µ–Ω–∏ –¥–∞–Ω–Ω–∏.

### –°—Ç—ä–ø–∫–∞ 2: –†–∞–∑–≥–ª–µ–∂–¥–∞–Ω–µ –Ω–∞ HTTP –¥–∞–Ω–Ω–∏

**a.** –í —Å—ä—â–∏—è –ø–∞–∫–µ—Ç, —Ä–∞–∑–≥—ä–Ω–µ—Ç–µ **Hypertext Transfer Protocol**

–©–µ –≤–∏–¥–∏—Ç–µ HTTP GET request:
```
GET / HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0...
Accept: text/html...
```

**b.** –ó–∞–±–µ–ª–µ–∂–µ—Ç–µ –∫–∞–ø—Å—É–ª–∏—Ä–∞–Ω–µ—Ç–æ:

- **Layer 4 (Transport):** TCP
- **Layer 7 (Application):** HTTP

---

## –ß–∞—Å—Ç 3: –ù–∞–±–ª—é–¥–∞–≤–∞–Ω–µ –Ω–∞ TCP Connection Termination

### –°—Ç—ä–ø–∫–∞ 1: –ù–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ FIN –ø–∞–∫–µ—Ç–∏

**a.** Scrolv–∞–π—Ç–µ –Ω–∞–¥–æ–ª—É –≤ packet list –¥–æ –∫—Ä–∞—è –Ω–∞ connection

**b.** –ü–æ—Ç—ä—Ä—Å–µ—Ç–µ –ø–∞–∫–µ—Ç–∏ —Å **[FIN, ACK]** –≤ Info –∫–æ–ª–æ–Ω–∞—Ç–∞

–©–µ –≤–∏–¥–∏—Ç–µ 4 –ø–∞–∫–µ—Ç–∞ –∑–∞ —Ç–µ—Ä–º–∏–Ω–∏—Ä–∞–Ω–µ:

1. **[FIN, ACK]** - –ï–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ –∏—Å–∫–∞ –¥–∞ –∑–∞—Ç–≤–æ—Ä–∏
2. **[ACK]** - –î—Ä—É–≥–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞
3. **[FIN, ACK]** - –î—Ä—É–≥–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ —Å—ä—â–æ –∏—Å–∫–∞ –¥–∞ –∑–∞—Ç–≤–æ—Ä–∏
4. **[ACK]** - –ü—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞

### –°—Ç—ä–ø–∫–∞ 2: –ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—ä—Ä–≤–∏—è FIN –ø–∞–∫–µ—Ç

**a.** –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –ø—ä—Ä–≤–∏—è –ø–∞–∫–µ—Ç —Å **[FIN, ACK]**

**b.** –†–∞–∑–≥—ä–Ω–µ—Ç–µ **Transmission Control Protocol**

```
Transmission Control Protocol
    Flags: 0x011 (FIN, ACK)
        .... ...1 .... = Acknowledgment: Set
        .... .... ...1 = Fin: Set
```

**c.** –û–±—è—Å–Ω–µ–Ω–∏–µ:

FIN flag –æ–∑–Ω–∞—á–∞–≤–∞: "–ù—è–º–∞–º –ø–æ–≤–µ—á–µ –¥–∞–Ω–Ω–∏ –∑–∞ –∏–∑–ø—Ä–∞—â–∞–Ω–µ, –≥–æ—Ç–æ–≤ —Å—ä–º –¥–∞ –∑–∞—Ç–≤–æ—Ä—è –≤—Ä—ä–∑–∫–∞—Ç–∞"

### –°—Ç—ä–ø–∫–∞ 3: –ê–Ω–∞–ª–∏–∑ –Ω–∞ ACK –æ—Ç–≥–æ–≤–æ—Ä

**a.** –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ —Å–ª–µ–¥–≤–∞—â–∏—è –ø–∞–∫–µ—Ç —Å **[ACK]**

**b.** –†–∞–∑–≥—ä–Ω–µ—Ç–µ TCP —Å–µ–∫—Ü–∏—è—Ç–∞

```
Flags: 0x010 (ACK)
    .... ...1 .... = Acknowledgment: Set
    .... .... ...0 = Fin: Not set
```

–¢–æ–≤–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –ø–æ–ª—É—á–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ FIN.

### –°—Ç—ä–ø–∫–∞ 4: –í—Ç–æ—Ä–∏ FIN-ACK –∏ —Ñ–∏–Ω–∞–ª–µ–Ω ACK

**c.** –†–∞–∑–≥–ª–µ–¥–∞–π—Ç–µ –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ –¥–≤–∞ –ø–∞–∫–µ—Ç–∞ –∑–∞ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ —Ç–µ—Ä–º–∏–Ω–∏—Ä–∞–Ω–µ—Ç–æ

–°–ª–µ–¥ —Ç–µ–∑–∏ 4 –ø–∞–∫–µ—Ç–∞, TCP connection –µ **–∑–∞—Ç–≤–æ—Ä–µ–Ω–∞**.

---

## –ß–∞—Å—Ç 4: –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ "Follow TCP Stream"

### –°—Ç—ä–ø–∫–∞ 1: –°–ª–µ–¥–≤–∞–Ω–µ –Ω–∞ –ø—ä–ª–Ω–∏—è conversation

**a.** –ú–∞—Ä–∫–∏—Ä–∞–π—Ç–µ **–ø—Ä–æ–∏–∑–≤–æ–ª–µ–Ω** –ø–∞–∫–µ—Ç –æ—Ç –≤–∞—à–∏—è HTTP connection

**b.** –î–µ—Å–µ–Ω –∫–ª–∏–∫ –≤—ä—Ä—Ö—É –ø–∞–∫–µ—Ç–∞ ‚Üí **Follow** ‚Üí **TCP Stream**

Wireshark —â–µ –ø–æ–∫–∞–∂–µ —Ü–µ–ª–∏—è conversation –≤ —á–µ—Ç–∏–º —Ñ–æ—Ä–º–∞—Ç!

### –°—Ç—ä–ø–∫–∞ 2: –†–∞–∑–≥–ª–µ–∂–¥–∞–Ω–µ –Ω–∞ TCP Stream –ø—Ä–æ–∑–æ—Ä–µ—Ü–∞

–©–µ –≤–∏–¥–∏—Ç–µ –Ω–µ—â–æ –ø–æ–¥–æ–±–Ω–æ:

```
GET / HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
...

HTTP/1.1 200 OK
Content-Type: text/html
...

<!DOCTYPE html>
<html>
...
```

**–ß–µ—Ä–≤–µ–Ω–∏—è—Ç —Ç–µ–∫—Å—Ç** = –∏–∑–ø—Ä–∞—Ç–µ–Ω–æ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞  
**–°–∏–Ω–∏—è—Ç —Ç–µ–∫—Å—Ç** = –ø–æ–ª—É—á–µ–Ω–æ –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞

**c.** –ó–∞—Ç–≤–æ—Ä–µ—Ç–µ TCP Stream –ø—Ä–æ–∑–æ—Ä–µ—Ü–∞

---

## –ß–∞—Å—Ç 5: –ê–Ω–∞–ª–∏–∑ –Ω–∞ Sequence –∏ Acknowledgment Numbers

### –°—Ç—ä–ø–∫–∞ 1: –ù–æ–≤ capture —Å –ø—Ä–æ—Å—Ç —Ç—Ä–∞—Ñ–∏–∫

**a.** –ó–∞—Ç–≤–æ—Ä–µ—Ç–µ —Å—Ç–∞—Ä–∏—è capture

**b.** –°—Ç–∞—Ä—Ç–∏—Ä–∞–π—Ç–µ –Ω–æ–≤ capture

**c.** –ü–æ—Å–µ—Ç–µ—Ç–µ http://example.com

**d.** –°–ø—Ä–µ—Ç–µ capture-–∞

### –°—Ç—ä–ø–∫–∞ 2: –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ Sequence Numbers

**a.** –§–∏–ª—Ç—Ä–∏—Ä–∞–π—Ç–µ: `tcp.port == 80`

**b.** –†–∞–∑–≥–ª–µ–¥–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–∏—Ç–µ –ø–∞–∫–µ—Ç–∏:

**–ü–∞–∫–µ—Ç 1 (SYN):**
- Seq = 0

**–ü–∞–∫–µ—Ç 2 (SYN-ACK):**
- Seq = 0 (—Å—ä—Ä–≤—ä—Ä)
- Ack = 1 (–ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—è Seq 0, –æ—á–∞–∫–≤–∞ Seq 1)

**–ü–∞–∫–µ—Ç 3 (ACK):**
- Seq = 1
- Ack = 1 (–ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ —Å—ä—Ä–≤—ä—Ä—Å–∫–∏—è Seq 0)

**–ü–∞–∫–µ—Ç 4 (HTTP GET):**
- Seq = 1
- Ack = 1
- Len = 200 (–∏–∑–ø—Ä–∞—â–∞ 200 –±–∞–π—Ç–∞ –¥–∞–Ω–Ω–∏)

**–ü–∞–∫–µ—Ç 5 (ACK –æ—Ç —Å—ä—Ä–≤—ä—Ä):**
- Seq = 1
- Ack = 201 (–ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –ø–æ–ª—É—á–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ 200 –±–∞–π—Ç–∞: 1 + 200 = 201)

### –°—Ç—ä–ø–∫–∞ 3: –†–∞–∑–±–∏—Ä–∞–Ω–µ –Ω–∞ Acknowledgment Numbers

**–§–æ—Ä–º—É–ª–∞:**
```
Next Expected Seq = Last Received Seq + Data Length
```

**–ü—Ä–∏–º–µ—Ä:**
- –ü–æ–ª—É—á–∏—Ö Seq=100, Length=50
- –ò–∑–ø—Ä–∞—â–∞–º Ack=150 (–æ—á–∞–∫–≤–∞–º —Å–ª–µ–¥–≤–∞—â–∏—è byte –¥–∞ –µ 150)

---

## –ß–∞—Å—Ç 6: –ù–∞–±–ª—é–¥–∞–≤–∞–Ω–µ –Ω–∞ TCP Retransmission

### –°—Ç—ä–ø–∫–∞ 1: –ü–æ—Ç—ä—Ä—Å–µ—Ç–µ retransmissions (–∞–∫–æ –∏–º–∞)

**a.** –í Wireshark filter:
```
tcp.analysis.retransmission
```

–ê–∫–æ –∏–º–∞ –∑–∞–≥—É–±–µ–Ω–∏ –ø–∞–∫–µ—Ç–∏, Wireshark —â–µ –≥–∏ –º–∞—Ä–∫–∏—Ä–∞ –∫–∞—Ç–æ **[TCP Retransmission]**.

### –°—Ç—ä–ø–∫–∞ 2: –ê–Ω–∞–ª–∏–∑ –Ω–∞ retransmission

–ê–∫–æ –≤–∏–¥–∏—Ç–µ —Ç–∞–∫—ä–≤ –ø–∞–∫–µ—Ç:

**b.** –ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –Ω–µ–≥–æ

**c.** Wireshark —â–µ –ø–æ–∫–∞–∂–µ:
```
[Expert Info: TCP Retransmission]
```

–¢–æ–≤–∞ –æ–∑–Ω–∞—á–∞–≤–∞, —á–µ –ø–∞–∫–µ—Ç—ä—Ç –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω –æ—Ç–Ω–æ–≤–æ, –∑–∞—â–æ—Ç–æ ACK –Ω–µ –µ –ø—Ä–∏—Å—Ç–∏–≥–Ω–∞–ª –Ω–∞–≤—Ä–µ–º–µ.

---

## –ß–∞—Å—Ç 7: TCP Connection States

–ü–æ –≤—Ä–µ–º–µ –Ω–∞ lifecycle, TCP –ø—Ä–µ–º–∏–Ω–∞–≤–∞ –ø—Ä–µ–∑ —Ä–∞–∑–ª–∏—á–Ω–∏ states:

| State | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| **CLOSED** | –ù—è–º–∞ connection |
| **LISTEN** | –°—ä—Ä–≤—ä—Ä —á–∞–∫–∞ connection |
| **SYN-SENT** | –ö–ª–∏–µ–Ω—Ç –∏–∑–ø—Ä–∞—Ç–∏ SYN |
| **SYN-RECEIVED** | –°—ä—Ä–≤—ä—Ä –ø–æ–ª—É—á–∏ SYN, –∏–∑–ø—Ä–∞—Ç–∏ SYN-ACK |
| **ESTABLISHED** | Connection –∞–∫—Ç–∏–≤–Ω–∞ |
| **FIN-WAIT-1** | –õ–æ–∫–∞–ª–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ –∏—Å–∫–∞ –∑–∞—Ç–≤–∞—Ä—è–Ω–µ |
| **FIN-WAIT-2** | –î—Ä—É–≥–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∞ —Å–µ —Å—ä–≥–ª–∞—Å–∏ |
| **CLOSE-WAIT** | –ß–∞–∫–∞ –ª–æ–∫–∞–ª–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–∞ –∑–∞—Ç–≤–æ—Ä–∏ |
| **TIME-WAIT** | –ß–∞–∫–∞ –ø—Ä–µ–¥–∏ –ø—ä–ª–Ω–æ –∑–∞—Ç–≤–∞—Ä—è–Ω–µ |
| **CLOSED** | Connection –∑–∞—Ç–≤–æ—Ä–µ–Ω–∞ |

### –í–∏–∂ —Ç–µ–∫—É—â–∏ TCP connections:

```cmd
C:\>netstat -an | findstr ESTABLISHED

TCP    192.168.1.100:54321    93.184.216.34:80       ESTABLISHED
```

---

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å—ä–≤–µ—Ç–∏ –∑–∞ Wireshark

### –ü–æ–ª–µ–∑–Ω–∏ TCP —Ñ–∏–ª—Ç—Ä–∏:

```
tcp                          # –í—Å–∏—á–∫–∏ TCP –ø–∞–∫–µ—Ç–∏
tcp.port == 80               # HTTP —Ç—Ä–∞—Ñ–∏–∫
tcp.port == 443              # HTTPS —Ç—Ä–∞—Ñ–∏–∫
tcp.flags.syn == 1           # –°–∞–º–æ SYN –ø–∞–∫–µ—Ç–∏
tcp.flags.syn == 1 && tcp.flags.ack == 1  # SYN-ACK –ø–∞–∫–µ—Ç–∏
tcp.flags.fin == 1           # FIN –ø–∞–∫–µ—Ç–∏
tcp.flags.reset == 1         # RST –ø–∞–∫–µ—Ç–∏ (abnormal close)
tcp.analysis.retransmission  # Retransmissions
tcp.stream eq 0              # –°–∞–º–æ –ø—ä—Ä–≤–∏—è TCP stream
```

### Colorize TCP flags:

–í Wireshark ‚Üí View ‚Üí Coloring Rules:

- **SYN –ø–∞–∫–µ—Ç–∏** - –°–∏–Ω —Ü–≤—è—Ç
- **FIN –ø–∞–∫–µ—Ç–∏** - –°–∏–≤ —Ü–≤—è—Ç  
- **RST –ø–∞–∫–µ—Ç–∏** - –ß–µ—Ä–≤–µ–Ω —Ü–≤—è—Ç

---

## –í—ä–ø—Ä–æ—Å–∏ –∑–∞ —Ä–∞–∑–º–∏—Å—ä–ª

**1.** –ó–∞—â–æ TCP –∏–∑–ø–æ–ª–∑–≤–∞ three-way handshake –≤–º–µ—Å—Ç–æ two-way?

_Three-way handshake –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞, —á–µ –∏ –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏ —Å–∞ –≥–æ—Ç–æ–≤–∏ –ò —Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–∞–Ω–∏. –ü—ä—Ä–≤–∏—Ç–µ –¥–≤–µ —Å—Ç—ä–ø–∫–∏ (SYN, SYN-ACK) —É—Å—Ç–∞–Ω–æ–≤—è–≤–∞—Ç connection –≤ –µ–¥–Ω–∞ –ø–æ—Å–æ–∫–∞. –¢—Ä–µ—Ç–∞—Ç–∞ —Å—Ç—ä–ø–∫–∞ (ACK) –ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –≤—Ä—ä–∑–∫–∞—Ç–∞ –≤ –æ–±—Ä–∞—Ç–Ω–∞—Ç–∞ –ø–æ—Å–æ–∫–∞ - bidirectional communication._

**2.** –ö–∞–∫–≤–æ —Å–µ —Å–ª—É—á–≤–∞ –∞–∫–æ SYN –ø–∞–∫–µ—Ç—ä—Ç —Å–µ –∑–∞–≥—É–±–∏?

_–ö–ª–∏–µ–Ω—Ç—ä—Ç —â–µ –∏–∑—á–∞–∫–∞ timeout (–æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ 3-6 —Å–µ–∫—É–Ω–¥–∏) –∏ —â–µ –∏–∑–ø—Ä–∞—Ç–∏ SYN –æ—Ç–Ω–æ–≤–æ. TCP –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ retry-–≤–∞ –Ω—è–∫–æ–ª–∫–æ –ø—ä—Ç–∏ –ø—Ä–µ–¥–∏ –¥–∞ —Å–µ –æ—Ç–∫–∞–∂–µ._

**3.** –ó–∞—â–æ sequence number –∑–∞–ø–æ—á–≤–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ —á–∏—Å–ª–æ –≤–º–µ—Å—Ç–æ 0?

_–°–ª—É—á–∞–π–Ω–∏—è—Ç ISN (Initial Sequence Number) –∑–∞—â–∏—Ç–∞–≤–∞ —Å—Ä–µ—â—É TCP hijacking attacks. –ê–∫–æ –∞—Ç–∞–∫—É–≤–∞—â –º–æ–∂–µ –¥–∞ –ø—Ä–µ–¥–≤–∏–¥–∏ —Å–ª–µ–¥–≤–∞—â–∏—è sequence number, —Ç–æ–π –º–æ–∂–µ –¥–∞ inject malicious –¥–∞–Ω–Ω–∏._

**4.** –ó–∞—â–æ ACK flag –µ –ø–æ—á—Ç–∏ –≤–∏–Ω–∞–≥–∏ –∑–∞–¥–∞–¥–µ–Ω —Å–ª–µ–¥ handshake?

_–°–ª–µ–¥ connection, –≤—Å—è–∫–∞ —Å—Ç—Ä–∞–Ω–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞ –ø–æ–ª—É—á–µ–Ω–∏ –¥–∞–Ω–Ω–∏. ACK flag –ø–æ–∫–∞–∑–≤–∞, —á–µ acknowledgment number –µ –≤–∞–ª–∏–¥–µ–Ω. –¢–æ–≤–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞ reliable delivery._

**5.** –ö–∞–∫–≤–æ –µ —Ä–∞–∑–ª–∏–∫–∞—Ç–∞ –º–µ–∂–¥—É FIN –∏ RST?

_**FIN** –µ graceful (–Ω–æ—Ä–º–∞–ª–Ω–æ) –∑–∞—Ç–≤–∞—Ä—è–Ω–µ - –¥–≤–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏ —Å–µ —Å—ä–≥–ª–∞—Å—è–≤–∞—Ç. **RST** –µ abrupt (—Ä—è–∑–∫–æ) –∑–∞—Ç–≤–∞—Ä—è–Ω–µ - –≤—Ä—ä–∑–∫–∞—Ç–∞ —Å–µ –ø—Ä–µ–∫—ä—Å–≤–∞ –≤–µ–¥–Ω–∞–≥–∞, –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ –ø–æ—Ä–∞–¥–∏ –≥—Ä–µ—à–∫–∞._

---

## –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (–ø–æ –∏–∑–±–æ—Ä)

### –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 1: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ TCP connections

–ù–∞–ø—Ä–∞–≤–µ—Ç–µ captures –∑–∞:
- HTTP (port 80)
- HTTPS (port 443) - encrypted
- SSH (port 22) - encrypted
- FTP (port 21) - clear text

–°—Ä–∞–≤–Ω–µ—Ç–µ Three-Way Handshake - –µ–¥–Ω–∞–∫—ä–≤ –ª–∏ –µ –∑–∞ –≤—Å–∏—á–∫–∏?

### –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 2: Window Size

–†–∞–∑–≥–ª–µ–¥–∞–π—Ç–µ Window field –≤ TCP header. –¢–æ–≤–∞ –µ flow control –º–µ—Ö–∞–Ω–∏–∑–º—ä—Ç.

```
Window: 65535
```

–ü–æ-–≥–æ–ª—è–º window = –ø–æ–≤–µ—á–µ –¥–∞–Ω–Ω–∏ –º–æ–≥–∞—Ç –¥–∞ —Å–µ –∏–∑–ø—Ä–∞—Ç—è—Ç –ø—Ä–µ–¥–∏ ACK.

### –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 3: TCP Options

–í SYN –ø–∞–∫–µ—Ç–∏, —Ä–∞–∑–≥—ä–Ω–µ—Ç–µ TCP Options:
- **MSS** (Maximum Segment Size)
- **Window Scale**
- **SACK Permitted** (Selective Acknowledgment)
- **Timestamps**

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í —Ç–æ–≤–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–∞—É—á–∏—Ö—Ç–µ –∫–∞–∫ –¥–∞:

‚úÖ –ó–∞—Å–Ω–µ–º–∞—Ç–µ TCP —Ç—Ä–∞—Ñ–∏–∫ –≤—ä–≤ Wireshark  
‚úÖ –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞—Ç–µ Three-Way Handshake (SYN, SYN-ACK, ACK)  
‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä–∞—Ç–µ TCP Control Flags  
‚úÖ –ù–∞–±–ª—é–¥–∞–≤–∞—Ç–µ connection —Ç–µ—Ä–º–∏–Ω–∏—Ä–∞–Ω–µ (FIN-ACK –ø—Ä–æ—Ü–µ—Å)  
‚úÖ –°–ª–µ–¥–∏—Ç–µ TCP conversation —Å Follow TCP Stream  
‚úÖ –†–∞–∑–±–∏—Ä–∞—Ç–µ Sequence –∏ Acknowledgment Numbers  

TCP –µ backbone-—ä—Ç –Ω–∞ –Ω–∞–¥–µ–∂–¥–Ω–∞—Ç–∞ Internet –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è. –ö–ª—é—á–æ–≤–∏ —Ç–æ—á–∫–∏:

- **Three-Way Handshake:** SYN ‚Üí SYN-ACK ‚Üí ACK
- **Reliable delivery:** Acknowledgments –∑–∞ –≤—Å–µ–∫–∏ byte
- **Ordered data:** Sequence numbers
- **Flow control:** Window size
- **Graceful termination:** FIN-ACK ‚Üí ACK ‚Üí FIN-ACK ‚Üí ACK

–ü–æ–∑–Ω–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ TCP –µ essential –∑–∞ network troubleshooting, security –∞–Ω–∞–ª–∏–∑ –∏ performance optimization!

---

## –ü–æ–ª–µ–∑–Ω–∏ –∫–æ–º–∞–Ω–¥–∏

### Windows:

```cmd
netstat -an                    # –í—Å–∏—á–∫–∏ –∞–∫—Ç–∏–≤–Ω–∏ connections
netstat -an | findstr ESTABLISHED  # –°–∞–º–æ established
netstat -ano                   # –ü–æ–∫–∞–∂–∏ Process ID (PID)
netstat -b                     # –ü–æ–∫–∞–∂–∏ –∏–º–µ—Ç–æ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ
```

### Telnet –∑–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ TCP connection:

```cmd
telnet example.com 80
GET / HTTP/1.1
Host: example.com

```

–£—Å–ø–µ—Ö —Å –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ TCP –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è! üîåüîç
